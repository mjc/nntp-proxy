# NNTP Proxy Configuration
#
# This file configures the proxy server, including listen address, backend servers,
# authentication, and health checking.

# Proxy Server Settings
[proxy]
# Host/IP to bind to (default: 0.0.0.0 - all interfaces)
host = "0.0.0.0"
# Port to listen on (default: 8119)
# Can be overridden with --port or NNTP_PROXY_PORT
port = 8119

# Routing Configuration
# Determines how the proxy selects which backend server to route requests to

# Routing strategy: "round-robin" or "adaptive-weighted"
# - round-robin: Distributes requests evenly across all backends (default)
#   Simple, predictable, works well for homogeneous backend pools
#
# - adaptive-weighted: Routes based on real-time performance metrics
#   Sends more traffic to faster, more reliable backends
#   Weights: pending_count (40%), TTFB (30%), error_rate (20%), hit_rate (10%)
#
# Can be overridden with NNTP_PROXY_ROUTING_STRATEGY environment variable
routing_strategy = "round-robin"

# Enable precheck detection (STAT/HEAD pattern analysis)
# When enabled, monitors for SABnzbd-style prechecks where clients send
# STAT/HEAD commands before requesting articles. Can optimize routing by
# avoiding unnecessary ARTICLE requests for missing content.
#
# Default: false (disabled for compatibility with all clients)
# Can be overridden with NNTP_PROXY_PRECHECK_ENABLED environment variable
precheck_enabled = false

# Client Authentication Configuration
# Two formats supported:
#
# 1. Single user (legacy format - still supported):
[client_auth]
username = "clientusername"
password = "client password"
# Optional custom greeting message
greeting = "200 Hold On To Your Butts"

# 2. Multiple users (NEW - recommended for grouping clients):
# [[client_auth.users]]
# username = "alice"
# password = "secret123"
#
# [[client_auth.users]]
# username = "bob"  
# password = "password456"
#
# [[client_auth.users]]
# username = "charlie"
# password = "hunter2"
#
# Benefits of multiple users:
# - Group parallel connections by username in TUI
# - Track per-user bandwidth and activity
# - Different credentials for different client machines
#
# Note: You can use either format, but not both. Multi-user is recommended
# for production deployments where you want to differentiate clients.

[[servers]]
host = "news.example.com"
port = 119
name = "Example News Server 1"
# Optional authentication - uncomment if needed
# username = "your_username"
# password = "your_password"
# High-capacity server allows many connections
max_connections = 20
# Connection health check interval (omit or comment out to disable, recommended: 60-120 seconds)
# Sends DATE command to detect stale connections before reuse
# connection_keepalive = 60
# TLS/SSL configuration
use_tls = false
tls_verify_cert = true

[[servers]]
host = "nntp.example.org"
port = 119
name = "Example News Server 2"
# This server requires authentication
username = "testuser"
password = "testpass"
# Standard connection limit
max_connections = 10
# Enable health checks every 60 seconds for this server
connection_keepalive = 60
# Plain TCP connection (default)
use_tls = false
tls_verify_cert = true

[[servers]]
host = "secure-news.example.com"
port = 563
name = "Secure News Server"
# Example with SSL/TLS port and authentication
username = "premium_user"
password = "secure_password"
# Premium server allows more connections
max_connections = 15
# Health checks recommended for production servers
connection_keepalive = 120
# Enable TLS for secure connection (NNTPS)
use_tls = true
# Verify server certificates (recommended for production)
tls_verify_cert = true
# Optional: custom CA certificate
# tls_cert_path = "/path/to/ca-cert.pem"

[[servers]]
host = "localhost"
port = 1119
name = "Local Test Server"
# No authentication needed for local server
# Limited connections for test server
max_connections = 5
# No health checks needed for local testing
# connection_keepalive = 0  # Not needed - disabled by default
use_tls = false
tls_verify_cert = true

# TLS/SSL Configuration Guide:
# - use_tls: Enable TLS/SSL encryption for this server (default: false)
# - tls_verify_cert: Verify server certificates using system certificate store (default: true, STRONGLY recommended)
# - tls_cert_path: Optional path to additional CA certificate file (PEM format)
#                  Note: This ADDS to system certs, does not replace them
#
# System Certificate Stores by OS:
# - Linux: Uses system CA bundle (usually /etc/ssl/certs)
# - macOS: Uses Security.framework (Keychain)
# - Windows: Uses SChannel (Windows Certificate Store)
#
# Only disable tls_verify_cert for testing/development - it's a security risk!
#
# Note: max_connections defaults to 10 if not specified
# Each server can have different limits based on your provider's restrictions
# Common NNTP ports: 119 (plain), 563 (NNTPS/SSL), 8119 (custom)
