# NNTP Proxy Configuration
#
# This file configures the proxy server, including listen address, backend servers,
# authentication, and health checking.

# Proxy Server Settings
[proxy]
# Host/IP to bind to (default: 0.0.0.0 - all interfaces)
host = "0.0.0.0"
# Port to listen on (default: 8119)
# Can be overridden with --port or NNTP_PROXY_PORT
port = 8119

# Routing Configuration
# Determines how the proxy selects which backend server to route requests to
[routing]
# Routing strategy: "round-robin" or "adaptive-weighted"
# - round-robin: Distributes requests evenly across all backends (default)
#   Simple, predictable, works well for homogeneous backend pools
#
# - adaptive-weighted: Routes based on real-time performance metrics
#   Sends more traffic to faster, more reliable backends
#   Weights: pending_count (40%), TTFB (30%), error_rate (20%), hit_rate (10%)
strategy = "round-robin"

# Smart article discovery (adaptive precheck)
# Automatically finds which backend has each article and caches the result.
#
# HOW IT WORKS:
# When you request an article by message-ID (STAT/ARTICLE/BODY/HEAD), the proxy
# checks all backends in parallel to see which ones have it. This information is
# cached so future requests go directly to the right backend.
#
# VALUE PROPOSITION:
#
# 1. WITH SABnzbd precheck ENABLED:
#    - First download of an NZB: ~50s (proxy prechecks all backends, builds cache)
#    - Re-downloading the same NZB later: <1s (cache hit, instant 223 responses)
#    - BENEFIT: 50x+ speedup for cached articles
#
# 2. WITH SABnzbd precheck DISABLED:
#    - Download time: ~50s (proxy does precheck work)
#    - BENEFIT: Guarantees no false "article missing" errors when article exists
#      on a different backend. Without this, SABnzbd tries one backend and may
#      fail even if another backend has the article.
#    - Also builds location cache for future requests
#    - AWR learns which backend is faster for actual downloads
#
# TRADEOFF:
# - First request pays 20-50s penalty to check all backends
# - Adds ~100 bytes memory per cached article
#
# Memory usage: ~64 MB for 640,000 cached articles
# Default: false (opt-in to avoid unexpected first-request latency)
adaptive_precheck = false

# How many articles to remember (each uses ~100 bytes)
# 640,000 articles = ~64 MB memory
# 1,000,000 articles = ~100 MB memory
precheck_cache_size = 640_000

# Client Authentication Configuration
# Two formats supported:
#
# 1. Single user (legacy format - still supported):
[client_auth]
username = "clientusername"
password = "client password"
# Optional custom greeting message
greeting = "200 Hold On To Your Butts"

# 2. Multiple users (NEW - recommended for grouping clients):
# [[client_auth.users]]
# username = "alice"
# password = "secret123"
#
# [[client_auth.users]]
# username = "bob"  
# password = "password456"
#
# [[client_auth.users]]
# username = "charlie"
# password = "hunter2"
#
# Benefits of multiple users:
# - Group parallel connections by username in TUI
# - Track per-user bandwidth and activity
# - Different credentials for different client machines
#
# Note: You can use either format, but not both. Multi-user is recommended
# for production deployments where you want to differentiate clients.

[[servers]]
host = "news.example.com"
port = 119
name = "Example News Server 1"
# Optional authentication - uncomment if needed
# username = "your_username"
# password = "your_password"
# High-capacity server allows many connections
max_connections = 20
# Connection health check interval (omit or comment out to disable, recommended: 60-120 seconds)
# Sends DATE command to detect stale connections before reuse
# connection_keepalive = 60
# TLS/SSL configuration
use_tls = false
tls_verify_cert = true

[[servers]]
host = "nntp.example.org"
port = 119
name = "Example News Server 2"
# This server requires authentication
username = "testuser"
password = "testpass"
# Standard connection limit
max_connections = 10
# Enable health checks every 60 seconds for this server
connection_keepalive = 60
# Plain TCP connection (default)
use_tls = false
tls_verify_cert = true

[[servers]]
host = "secure-news.example.com"
port = 563
name = "Secure News Server"
# Example with SSL/TLS port and authentication
username = "premium_user"
password = "secure_password"
# Premium server allows more connections
max_connections = 15
# Health checks recommended for production servers
connection_keepalive = 120
# Enable TLS for secure connection (NNTPS)
use_tls = true
# Verify server certificates (recommended for production)
tls_verify_cert = true
# Optional: custom CA certificate
# tls_cert_path = "/path/to/ca-cert.pem"

[[servers]]
host = "localhost"
port = 1119
name = "Local Test Server"
# No authentication needed for local server
# Limited connections for test server
max_connections = 5
# No health checks needed for local testing
# connection_keepalive = 0  # Not needed - disabled by default
use_tls = false
tls_verify_cert = true

# TLS/SSL Configuration Guide:
# - use_tls: Enable TLS/SSL encryption for this server (default: false)
# - tls_verify_cert: Verify server certificates using system certificate store (default: true, STRONGLY recommended)
# - tls_cert_path: Optional path to additional CA certificate file (PEM format)
#                  Note: This ADDS to system certs, does not replace them
#
# System Certificate Stores by OS:
# - Linux: Uses system CA bundle (usually /etc/ssl/certs)
# - macOS: Uses Security.framework (Keychain)
# - Windows: Uses SChannel (Windows Certificate Store)
#
# Only disable tls_verify_cert for testing/development - it's a security risk!
#
# Note: max_connections defaults to 10 if not specified
# Each server can have different limits based on your provider's restrictions
# Common NNTP ports: 119 (plain), 563 (NNTPS/SSL), 8119 (custom)
