#!/usr/bin/env bash
set -e

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
BINARY="$SCRIPT_DIR/../target/release/parse_flamegraph"
SOURCE="$SCRIPT_DIR/parse_flamegraph.rs"

# Rebuild if source is newer than binary or binary doesn't exist
if [ ! -f "$BINARY" ] || [ "$SOURCE" -nt "$BINARY" ]; then
    echo "Compiling parse_flamegraph..." >&2
    rustc -O -o "$BINARY" "$SOURCE"
fi

exec "$BINARY" "$@"
